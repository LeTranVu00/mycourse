{% extends 'courses/base.html' %}
{% load static %}  <!-- TH√äM D√íNG N√ÄY -->

{% block content %}
<div class="checkout-container">
    <h2>üí≥ Thanh to√°n</h2>
    
    <div class="checkout-summary">
        <h3>ƒê∆°n h√†ng c·ªßa b·∫°n:</h3>
        {% for item in cart_items %}
        <div class="checkout-item">
            <h4>{{ item.course.title }}</h4>
            <p class="price">{{ item.course.price }} VNƒê</p>
        </div>
        {% endfor %}
        
        <div class="total-amount">
            <h3>T·ªïng c·ªông: {{ total_amount }} VNƒê</h3>
        </div>
    </div>

    <div class="payment-methods">
        <h3>Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n:</h3>
        <form method="post" id="payment-form">
            {% csrf_token %}
            
            <div class="payment-option">
                <input type="radio" name="payment_method" value="momo" id="momo" required 
                       onchange="showQRCode('momo')">
                <label for="momo">
                    <span style="font-size: 1.2em;">üì±</span> MoMo QR Code
                </label>
            </div>
            
            <div class="payment-option">
                <input type="radio" name="payment_method" value="banking" id="banking"
                       onchange="showQRCode('banking')">
                <label for="banking">
                    <span style="font-size: 1.2em;">üè¶</span> Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                </label>
            </div>
            
            <div class="payment-option">
                <input type="radio" name="payment_method" value="cod" id="cod"
                       onchange="showQRCode('cod')">
                <label for="cod">
                    <span style="font-size: 1.2em;">üì¶</span> Thanh to√°n khi nh·∫≠n kh√≥a h·ªçc
                </label>
            </div>
            
            <!-- QR Code MoMo Section -->
            <div id="momo-section" style="display: none; margin: 20px 0; text-align: center;">
                <h4>üì≤ Qu√©t m√£ QR ƒë·ªÉ thanh to√°n qua MoMo</h4>
                <img src="{% static 'courses/images/momo-qr.png' %}" 
                     alt="QR Code MoMo" 
                     style="width: 250px; height: 250px; border: 2px solid #ddd; border-radius: 10px;">
                <div style="margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <p><strong>H∆∞·ªõng d·∫´n thanh to√°n:</strong></p>
                    <p>1. M·ªü ·ª©ng d·ª•ng MoMo</p>
                    <p>2. Ch·ªçn "Qu√©t m√£"</p>
                    <p>3. Qu√©t m√£ QR b√™n tr√™n</p>
                    <p>4. X√°c nh·∫≠n thanh to√°n</p>
                </div>
            </div>
            
            <!-- Banking Info Section -->
            <div id="banking-section" style="display: none; margin: 20px 0;">
                <h4>üè¶ Th√¥ng tin chuy·ªÉn kho·∫£n</h4>
                <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <img src="{% static 'courses/images/bank-qr.png' %}" 
                             alt="QR Code Ng√¢n h√†ng" 
                             style="width: 250px; height: 250px; border: 2px solid #ddd; border-radius: 10px;">
                    </div>
                    <div style="flex: 1; min-width: 250px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <p><strong>Ng√¢n h√†ng:</strong> Viettinbank</p>
                        <p><strong>Chi nh√°nh:</strong> Th√†nh ph·ªë H·ªì Ch√≠ Minh</p>
                        <p><strong>S·ªë t√†i kho·∫£n:</strong> 0396870877</p>
                        <p><strong>Ch·ªß t√†i kho·∫£n:</strong> L√™ Tr·∫•n V≈©</p>
                        <p><strong>S·ªë ti·ªÅn:</strong> {{ total_amount }} VNƒê</p>
                        <p><strong>N·ªôi dung:</strong> {{ user.username }} thanh to√°n khoa hoc</p>
                        <div style="background: #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <small>‚è∞ Sau khi chuy·ªÉn kho·∫£n, vui l√≤ng ch·ªù 5-10 ph√∫t ƒë·ªÉ h·ªá th·ªëng x√°c nh·∫≠n</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COD Section -->
            <div id="cod-section" style="display: none; margin: 20px 0; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h4>üì¶ Thanh to√°n khi nh·∫≠n kh√≥a h·ªçc</h4>
                <p>B·∫°n s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t kh√≥a h·ªçc ngay sau khi x√°c nh·∫≠n th√¥ng tin.</p>
                <p>Vui l√≤ng cung c·∫•p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ nh√¢n vi√™n li√™n h·ªá x√°c nh·∫≠n:</p>
                <input type="tel" name="phone_number" placeholder="S·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n" 
                       style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <button type="submit" class="pay-button" id="submit-button">
                üí≥ X√°c nh·∫≠n thanh to√°n - {{ total_amount }} VNƒê
            </button>
        </form>
    </div>
</div>

<script>
function showQRCode(paymentMethod) {
    const momoSection = document.getElementById('momo-section');
    const bankingSection = document.getElementById('banking-section');
    const codSection = document.getElementById('cod-section');
    
    // ·∫®n t·∫•t c·∫£ sections
    momoSection.style.display = 'none';
    bankingSection.style.display = 'none';
    codSection.style.display = 'none';
    
    // Hi·ªÉn th·ªã section ƒë∆∞·ª£c ch·ªçn
    if (paymentMethod === 'momo') {
        momoSection.style.display = 'block';
    } else if (paymentMethod === 'banking') {
        bankingSection.style.display = 'block';
    } else if (paymentMethod === 'cod') {
        codSection.style.display = 'block';
    }
}

// T·ª± ƒë·ªông ch·ªçn MoMo khi trang load
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('momo').checked = true;
    showQRCode('momo');
});
</script>

<style>
.checkout-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
.checkout-summary { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
.checkout-item { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
.total-amount { background: #27ae60; color: white; padding: 20px; border-radius: 10px; margin-top: 20px; text-align: center; }
.payment-methods { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.payment-option { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border: 2px solid #e9ecef; cursor: pointer; }
.payment-option:hover { border-color: #3498db; background: #e3f2fd; }
.payment-option input[type="radio"] { margin-right: 10px; }
.payment-option label { cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 10px; }
.pay-button { 
    background: #e74c3c; 
    color: white; 
    padding: 18px; 
    border: none; 
    border-radius: 8px; 
    font-size: 1.2em; 
    cursor: pointer; 
    margin-top: 25px; 
    width: 100%; 
    transition: all 0.3s ease;
}
.pay-button:hover { 
    background: #c0392b; 
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
    .checkout-container { padding: 10px; }
    .checkout-summary { padding: 15px; }
    .payment-methods { padding: 15px; }
    
    #banking-section .flex-container {
        flex-direction: column;
    }
}
</style>
{% endblock %}