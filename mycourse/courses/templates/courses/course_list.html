{% extends 'courses/base.html' %}

{% block content %}
    <h2>Danh s√°ch kh√≥a h·ªçc</h2>
    {% if selected_category %}
    <div style="text-align: center; margin: 20px 0;">
        <h2>üìÅ Danh m·ª•c: 
            {% for choice in course_categories %}
                {% if choice.0 == selected_category %}{{ choice.1 }}{% endif %}
            {% endfor %}
        </h2>
        <a href="/" style="color: #3498db;">‚Üê Xem t·∫•t c·∫£ kh√≥a h·ªçc</a>
    </div>
    {% endif %}
    
    <h2>{% if selected_category %}Kh√≥a h·ªçc {{ selected_category }}{% else %}Danh s√°ch kh√≥a h·ªçc{% endif %}</h2>
    <div class="course-list">
        {% for course in courses %}
        <div class="course-card">
            <h3>{{ course.title }}</h3>
            <p>{{ course.description|truncatewords:20 }}</p>
            <p class="price">{{ course.price }} VNƒê</p>

                <!-- TH√äM N√öT TH√äM V√ÄO GI·ªé H√ÄNG V√Ä MUA NGAY -->
            {% if user.is_authenticated %}
                <div style="display: flex; gap: 10px; margin: 15px 0;">
                    <form action="/add-to-cart/{{ course.id }}/" method="post" style="flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn-add-cart">
                            üõí Th√™m v√†o gi·ªè
                        </button>
                    </form>
                    
                    <form action="/checkout-direct/{{ course.id }}/" method="post" style="flex: 1;">
                        {% csrf_token %}
                        <button type="submit" style="
                            background: #e74c3c;
                            color: white;
                            border: none;
                            padding: 12px;
                            border-radius: 5px;
                            cursor: pointer;
                            width: 100%;
                            font-size: 1em;
                        ">
                            ‚ö° Mua ngay
                        </button>
                    </form>
                </div>
            {% else %}
                <p style="text-align: center; margin-top: 15px;">
                    <a href="/accounts/login/" style="color: #3498db;">üîê ƒêƒÉng nh·∫≠p</a> ƒë·ªÉ mua kh√≥a h·ªçc
                </p>
            {% endif %}
            
            <a href="/course/{{ course.id }}/">Xem chi ti·∫øt</a>
        </div>
        {% empty %}
        <p>Ch∆∞a c√≥ kh√≥a h·ªçc n√†o.</p>
        {% endfor %}
    </div>
{% endblock %}